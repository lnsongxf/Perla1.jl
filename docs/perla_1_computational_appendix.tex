% !TEX program = pdflatex
\documentclass[12pt]{article}
\usepackage{amsmath,amssymb,amsfonts,amsthm,amsopn,amstext,thmtools,setspace,ifthen,tabularx}
\usepackage{bbm,dsfont,lmodern,accents} %Display packages
\usepackage[T1]{fontenc}
\usepackage[nohead]{geometry}
\usepackage{xr-hyper}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage[bookmarks=false,
	pdfstartview={FitV},
	pdftitle={A Model of Product Awareness and Industry Life Cycle},
	pdfauthor={Jesse Perla},
	pdfcreator={Jesse Perla},
	pdfkeywords={Macroeconomics, Firm Growth, Firm Dynamics, Firm Heterogeneity, Industry Equilibrium, Industry Life Cycle, Product Differentiation},
	pdfsubject={Macroeconomics},
	colorlinks=true,
	linkcolor=darkgray,
	citecolor=darkgray,
	urlcolor=darkgray,
	filecolor=darkgray,
	anchorcolor=darkgray, 
	breaklinks]{hyperref}
\usepackage[capitalise,noabbrev]{cleveref}
\crefname{equation}{}{}
\crefname{assumption}{Assumption}{Assumptions}
\crefname{property}{Property}{Properties}
\newtheorem{theorem}{Theorem}%[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\declaretheorem[numbered=yes]{definition}
\newtheorem{example}{Example}
\newtheorem{proposition}{Proposition}
\newtheorem{assumption}{Assumption}

%%%%%%%%%%%% Macros%%%%%%
\newcommand{\includepsfragfig}[5][width=\columnwidth] {%
	\begin{figure}[!htp]%
		\centering		
		\psfragfig[#1]{#2}{#5} %	
		\ifthenelse{\equal{#3}{}}{}{\caption{#3}} % Conditionally shows the caption
		\ifthenelse{\equal{#4}{}}{}{\label{#4}} % Conditionally shows the alabel
	\end{figure}
}
\newcommand{\set}[1]{\ensuremath{\left\{{#1}\right\}}}
\newcommand{\pd}[2]{\ensuremath{\frac{\partial#1}{\partial#2}}}
\newcommand{\tpd}[2]{\ensuremath{\tfrac{\partial#1}{\partial#2}}}
\newcommand{\R}{\ensuremath{\mathbb{R}}}
\newcommand{\N}[1][]{\ensuremath{\mathbb{N_{#1}}}}
\newcommand{\Q}[0]{\ensuremath{\mathbb{Q}}}
\newcommand{\D}[1][]{\ensuremath{\boldsymbol{\partial}_{#1}}}
\newcommand{\st}[0]{\,\text{s.t.}\,}
\newcommand{\ow}[0]{\,\text{o.w.}\,}
\newcommand{\prob}[2][]{\ensuremath{\mathbb{P}_{#1}\left( {#2} \right)}}
\newcommand{\cprob}[2]{\ensuremath{\mathbb{P}\left( {#1}\left| {#2} \right. \right)}}
\newcommand{\expec}[2][]{\ensuremath{\mathbb{E}_{{#1}}\left[ {#2} \right]}}
\newcommand{\condexpec}[3][]{\ensuremath{\mathbb{E}_{#1}\left[{#2} \; \middle| \; {#3} \right]}}
\newcommand{\diff}{\ensuremath{\mathrm{d}}}
\newcommand{\indicator}[1]{\ensuremath{\mathds{1}\left\{{#1}\right\}}}
\newcommand{\abs}[1]{\ensuremath{\left| {#1}\right|}}
\newcommand{\argmax}[2]{\ensuremath{\mathrm{arg} \max_{{#1}}\left\{ {#2} \right\}}}
%%%%%%%%%%%%%%%%%%%%%%%%%

\geometry{left=1in,right=1in,top=0.6in,bottom=1in}

\interfootnotelinepenalty=1000

\onehalfspacing
\begin{document}
\title{\Large A Model of Product Awareness and Industry Life Cycle\\
Online Computational  Appendix
}
\author{Jesse Perla \\ University of British Columbia}
\date{Draft Date: \today}
\maketitle
\appendix
\makeatletter
\def\@seccntformat#1{Appendix\ \csname the#1\endcsname\quad}
\makeatother
\makeatletter
\def\@seccntformat#1{\csname Pref@#1\endcsname \csname the#1\endcsname\quad}
\def\Pref@section{Appendix~}
\makeatother
\numberwithin{equation}{section}

\section{Multiple Cohorts and Awareness Counts}\label{sec:cohort-notation}
To introduce multiple cohorts,
\begin{itemize}
	\item Cohorts are indexed by $ b = 1, \ldots \bar{b}$ where the symmetric case in the paper is nested with $\bar{b} = 1$
	\item Let $a_b$ be the industry age at birth for cohort $b$.  Typically, $a_1 = 0$ since the industry starts with the first cohort.
	\item There are $N_b$ firms in cohort $b$, but in the symmetric case with the same number of firms per cohort we will just use $N$
	\item Given symmetric awareness evolution within a cohort, denote the set of possible awareness set counts as $\mathcal{N}$ and the cardinality of the set of awareness sets is then
	\begin{align}
	\mathbf{N} &\equiv \abs{\mathcal{N}} = \prod_{b = 1}^{\bar{b}}(N_b + 1)
	\end{align}
	\item In the example of cohorts of the same size, $\mathcal{N} \equiv \set{0, 1,\ldots N}^{\bar{b}}$
	\item We can use $n_b \in \set{0, \ldots, N_b}$ to be an awareness set with $n_b$ firms in the awareness set size for cohort $b$.  This is a generalization of the $n$ used with a single cohort.	
	\item The awareness state for an industry is $f(a) \in \R^{\mathbf{N}}$, which generalizes the one-cohort example in the main paper.
	\item An element from the $\mathbf{N}$ possible awareness sets is a $n \in \mathcal{N}$
	\begin{align}
	n &\equiv \set{n_1, \ldots n_b, \ldots n_{\bar{b}}}
	\end{align}
	\item Denote a sum over all possible awareness count permutations as $\sum_{n \in \mathcal{N}}$, etc.
\end{itemize}
Generalizing the awareness count evolution, we now have a infinitesimal generator $Q \in \R^{\mathbf{N} \times\mathbf{N}}$ such that the evolution of awareness is
\begin{align}
\D[t]f(a) &= f(a) \cdot Q(a, f)
\end{align}
Which nests the single-cohort case and can potentially be nonlinear or time-inhomogenous


\section{Model of Awareness in Main Paper}
The following summarizes the law of motion for the main paper, which uses the count of firms in the awareness sets
\begin{align}
	\D[a]f(a) &= f(a) \cdot \Q(a),\quad \text{given initial condition } f(0)\in\R^{N+1}\label{eq:f-evolution-ode}
	\end{align}
	
	\noindent The solution to \cref{eq:f-evolution-ode} in terms of matrix exponentials is, % given any age-varying intensity matrix,
	\begin{align}
	f(a) &= \begin{bmatrix}1 & 0 & \ldots & 0\end{bmatrix}\cdot e^{\int_{0}^{a} \Q(s)\diff s} %\label{eq:f-constant-Q-evolution}\\
	%\intertext{For the simple case of a time invariant intensity matrix,}
	= \begin{bmatrix}1 & 0 & \ldots & 0\end{bmatrix}\cdot e^{a\Q},\, \text{for an age invariant $\Q$}\label{eq:f-constant-Q-evolution}
\end{align}

\begin{example}[Baseline Awareness Process]\label{example:bass-style}
	Given $\mu,\theta,$ and $\theta_d$, awareness evolves according to the following age-dependent intensity matrix.
	
	\begin{equation}
	\Q(a) = \left[\begin{smallmatrix}
	-\left(\theta + \theta_d (1 - f_0(a))\right) & \theta + \theta_d (1 - f_0(a)) & 0 & \ldots & & & \ldots & 0\\
	\mu  & -\mu - \tfrac{N-1}{N}\theta & \tfrac{N-1}{N}\theta & 0 & \ldots & & \ldots & 0\\
	%0 & \mu & - \left(\tfrac{N-2}{N}\theta + \mu \right) & \tfrac{N-2}{N}\theta & 0 & \ldots &  \ldots & 0\\
	\vdots & & & & & & & \vdots\\ % & \ldots& \ldots& \ldots & \ldots & \ldots & \vdots\\
	0 & 0 & 0 & 0 & \ldots &\mu & -\mu -\tfrac{1}{N}\theta & \tfrac{1}{N}\theta\\
	0 & 0 & 0 & 0 & \ldots & 0 & \mu & -\mu
	\end{smallmatrix}\right]\in \R^{(N+1)\times(N+1)}\label{eq:baseline-Q}
	\end{equation}
	When $\mu=0$, the KFE \cref{eq:f-constant-Q-evolution} with generator \cref{eq:baseline-Q} separates into an ODE in the number of customers aware of no products in the category, $\D[a] f_0(a) = -f_0(a)\left(\theta + \theta_d (1 - f_0(a))\right)$.  With the initial condition $f_0(0) = 1$, the solution to this ODE is
	\begin{equation}
	f_0(a) = \frac{\theta_d + \theta}{\theta_d + \theta \exp\left((\theta_d + \theta )a\right)}
	\end{equation}
	\end{example}

% \begin{example}[Without Word of Mouth]\label{example:balking}
% 	Assume that each consumer has an intensity $\theta > 0$ of becoming aware of a firm in an industry, and an equal probability of becoming aware of a particular firm (including the potential of repeating a meeting with an existing firm in her information set, which doesn't add to the count).  Also assume that customers can forget an existing firm at rate $\mu \geq 0$.  Then, the infinitesimal generator is
% 	\begin{equation}
% 	\Q = \left[\begin{smallmatrix}
% 	-\theta & \theta & 0 & \ldots & & & \ldots & 0\\
% 	\mu & - \left(\tfrac{N-1}{N}\theta + \mu \right) & \tfrac{N-1}{N}\theta & 0 & \ldots & & \ldots & 0\\
% 	0 & \mu & - \left(\tfrac{N-2}{N}\theta + \mu \right) & \tfrac{N-2}{N}\theta & 0 & \ldots &  \ldots & 0\\
% 	\vdots & & & & & & & \vdots\\ % & \ldots& \ldots& \ldots & \ldots & \ldots & \vdots\\
% 	0 & 0 & 0 & 0 & \ldots &\mu & -\left(\tfrac{1}{N}\theta + \mu \right) & \tfrac{1}{N}\theta\\
% 	0 & 0 & 0 & 0 & \ldots & 0 & \mu & -\mu
% 	\end{smallmatrix}\right]\in \R^{(N+1)\times(N+1)}
% 	\end{equation}
% \end{example}


\section{General Law of Motion for Awareness}
The goal of the laws of motion for awareness are to build a model of the proportion of agents that have a particular awareness state for the firms in an industry.


The key questions of heterogeneity in this model are: (1) is the productivity/quality of firms symmetric?; (2) do all firms enter at the same time?; and (3) conditional on a particular time of entry, does awareness evolve symmetrically for those firms (i.e. independent of productivity/quality).  In this section, I describe the most general approach, allowing for complete heterogeneit with no assumptions of symmetry in the awareness process.  In \cref{sec:cohort-symmetry} we examine a simplification where awareness is assumed to evolve symmetrically for all productivity/quality types in a given cohort, which significantly decreases the required dimensionality of the problem.  Later, we will show that this is a sufficient statistic to calculation the pricing, output, and profits functions of firms with heterogeneity in their productivity/quality.

\subsection{Cardinality and Distributions}
Before any assumptions on symmetry--if there were a maximum of $\mathcal{I} \equiv \set{1,\ldots N}$ firms operating in an industry over the lifetime, then the cardinality of the possible awareness sets, $A$ for consumers is $\mathbf{2}^{\mathcal{I}}$, with cardinality $\mathbf{N} \equiv \abs{\mathbf{2}^{\mathcal{I}}} = \sum_{k=0}^{N} \dbinom{N}{k}$

Then the awareness state in an industry of age $a$ is $\hat{f}(a, A) : \R^{\mathbf{N}} \to \R$, with $\sum\limits_{A \in \mathbf{2}^{\mathcal{I}}}\hat{f}(a, A) = 1$.  To create a Markov chain for this very general process, I need to establish a consistent ordering of the states in $\hat{f}(a, A)$, which can be done with the lexicographic matrix \cref{eq:lexicographic-matrix}.  That way, $\hat{f}(a) \in \R^{\mathbf{N}}$ becomes the 

\subsection{Example Stochastic Process}\label{sec:fully-differentiated-example}

In this section will modify the process to allow for full differentiation of firms in the $\hat{f}(a,A)$ evolution process.  The infinitesimal generator of the Markov chain (no longer just a count process) is denoted $\hat{\Q}$, and for simplicity I assume there is no forgetting (i.e., $\mu = 0$).

\paragraph{Baseline Awareness Model With Full Differentiation}
Asume each consumer has a $\theta > 0$ probability of becoming aware of some firm in an industry, and an equal probability of becoming aware of a particular firm (including the potential of repeating a meeting with an existing firm in there information set, which doesn't change awareness) and word of mouth diffusion.  The infinitesimal generator is $\hat{\Q}(a)\in \R^{\mathbf{N}\times\mathbf{N}}$, where the $(\iota, \iota')$ element is of the Markov process is given by
 \begin{align}
\hat{\Q}_{\iota \iota'}(a) & = \begin{cases}
 - (\theta + \theta_d(1 - \hat{f}_0(a)) & \iota' = \iota = 1\\
\frac{\theta + \theta_d(1 - \hat{f}_0(a))}{N}  & \iota = 1, 1 < \iota \leq N\\
 - \theta + \tfrac{\theta}{N}\mathbf{e}_{\iota} \mathbf{L}\, \vec{\mathbf{1}}^T & \iota' = \iota > 1\\
 \tfrac{\theta}{N}&  (\mathbf{e}_{\iota'} - \mathbf{e}_{\iota})\mathbf{L} = 1\\
0 & \ow
\end{cases}\label{eq:differentiated-Q-wom}\\
\intertext{Awareness evolves through the solution to the following system of differential equations given the initial condition $\hat{f}(0)$,}
\D[a] \hat{f}(a) &= \hat{f}(a)\cdot\hat{\Q}(a)\label{eq:differentiated-LOM-wom}
\intertext{In the case with no word-of-mouth diffusion, $\theta_d = 0$, \cref{eq:differentiated-Q-wom} simplifies to the age-invariant Markov-chain}
\hat{\Q}_{\iota \iota'} & = \begin{cases}
 - \theta + \tfrac{\theta}{N}\mathbf{e}_{\iota} \mathbf{L}\, \vec{\mathbf{1}}^T & \iota' = \iota\\
 \tfrac{\theta}{N}&  (\mathbf{e}_{\iota'} - \mathbf{e}_{\iota})\mathbf{L} = 1\\
0 & \ow
\end{cases}
\end{align}
and the unconditional distribution of awareness in the economy with $\theta_d = 0$ in \cref{eq:differentiated-LOM-wom} evolves from the initial condition as,
\begin{equation}
\hat{f}(a) = \hat{f}(0) \cdot e^{a \hat{\Q}}\in\R^{\mathbf{N}}
\end{equation}

As previously discussed, if there is any symmetry in the set of firms, this process can be simplified substantially.  Regardless, systems of ODEs of the form \cref{eq:differentiated-LOM-wom} can be solved numerically for \textit{very} large $\mathbf{N}$.

\subsection{Mapping Duopoly Example to the Count Distribution}\label{sec:mapping-duopoly}
This section takes a simple symmetric duopoly with firms $\set{1,2}$ and connects \cref{example:balking-full-differentation} with $\hat{f}(\cdot)$  and $\hat{\Q}$, to Main  \cref{main:example:bass-style}  with $f(\cdot)$ and $\Q$, look at a duopoly.

From \cref{example:balking-full-differentation}, the pmf is $\hat{f}(a, A)$ for $A$ accorded according to $\set{\emptyset, \set{1}, \set{2}, \set{1,2}}$, and with the infinitesimal generator,
$$
\hat{\Q}(a) \equiv \begin{bmatrix}
-(\theta + \theta_d(1 - \hat{f}_0(a))) & (\theta + \theta_d(1 - \hat{f}_0(a)))/2 & (\theta + \theta_d(1 - \hat{f}_0(a)))/2 & 0\\
0 & -\theta/2 & 0 & \theta/2\\
0 & 0 & -\theta/2 & \theta/2\\
0 & 0 & 0 & 0
\end{bmatrix}
$$
From these, define the count distribution as: $f_0(a) \equiv \hat{f}(a, \emptyset), f_1(a) \equiv \hat{f}(a, \set{1}) + \hat{f}(a, \set{2}),$ and $ f_2(a) \equiv \hat{f}(a, \set{1,2})$.  The generator becomes identical to  Main  \cref{main:example:bass-style} with $N=2$,
$$
\Q(a) \equiv \begin{bmatrix}
-(\theta + \theta_d(1 - f_0(a))) & \theta + \theta_d(1 - f_0(a))& 0\\
0 & -\theta/2 & \theta/2\\
0 & 0 & 0
\end{bmatrix}
$$

\section{Symmetric Awareness Process by Cohort}\label{sec:cohort-symmetry}
The full model for awareness in the previous 


\section{Profits and Prices}

Define,
\begin{align}
	\bar{\Gamma} &\equiv \Gamma(1-\sigma(\kappa-1))^{1/(1-\kappa)}
	\intertext{With $\Gamma(\cdot)$ the gamma function.  Assume,}
	0 &< \sigma < \frac{1}{\kappa - 1}
\end{align}
Total Demand in an industry of age $a$ with firms of quality $q_i$ choosing prices $p_i$ is
\begin{align}
y_i(a,p) &= \bar{\Gamma}^{1-\kappa}\Omega \, q_i^{\kappa - 1}p_i^{-1/\sigma - 1}\,\sum_{{A}\,|\, i}\left(\hat{f}(a,A)\left[\sum_{i'\in A}\left( \frac{q_i}{q_{i'}} p_{i'}\right)^{-1/\sigma}\right]^{\sigma (\kappa - 1)-1}\right)\\
&= \bar{\Gamma}^{1-\kappa}\Omega \, q_i^{1/\sigma}p_i^{-1/\sigma - 1}\,\sum_{{A}\,|\, i}\left(\hat{f}(a,A)\left[\sum_{i'\in A}\left( \frac{p_{i'}}{q_{i'}}\right)^{-1/\sigma}\right]^{\sigma (\kappa - 1)-1}\right)\label{eq:full-total-demand}
\end{align}

\subsection{Demand with Multiple Cohorts of Symmetric Quality}
Using the notation in \cref{sec:cohort-notation}, denote the quality and price of all forms in cohort $b$ as $q_b$ and $p_b$.  For deriving the demand, we will consider firm $i$ in cohort $b$ as having price $i$, so that the demand function is
\begin{align}
y_{ib}(p_i, p_{-i}, f) &= \sum_{ n \in \mathcal{N} } n_b f_n \Bigg[ \sum_{b' =1 }^{\bar{b}} n_{b'} \left( \dfrac{p_{b'}}{q_{b'}}  \right)^{-1/\sigma} +   
p_i^{-1/\sigma}   - p^{-1/\sigma}_{b}  \Bigg]^{\sigma(\kappa-1) -1}\label{eq:total-demand-multiple-cohorts}
\end{align}
Here we drop the $a$ since the $f$ vector provides the sufficient information to calculate demand and prices. 

To verify that the formula in \cref{eq:total-demand-multiple-cohorts} is correct, note that 
\begin{align}
y_{ib}(p_i, p_{-i}, f)  = \bar{\Gamma}^{1-\kappa}\Omega \, q_b^{1/\sigma}p_i^{-1/\sigma - 1}\,\sum_{{A}\,|\, i}\left(\hat{f}(a,A)\left[\sum_{i'\in A}\left( \frac{p_{b(i')}}{q_{b(i')}}\right)^{-1/\sigma}\right]^{\sigma (\kappa - 1)-1}\right)\label{eq:full-total-demand-multiple-cohorts}
\end{align}
holds by \cref{eq:full-total-demand} where $b(i')$ denotes the cohort firm $i'$ belongs to. 

The summation in \cref{eq:full-total-demand-multiple-cohorts} is an expectation with respect to the random awareness set conditional on firm $i$ being awared. For $n \in \mathcal{N}$, note that firm $i$ is awared if and only if $A$ conditional on $n$ contains firm $i$. Thus, \cref{eq:full-total-demand-multiple-cohorts} can be rewritten as
\begin{align}
y_{ib}(p_i, p_{-i}, f)  &= \bar{\Gamma}^{1-\kappa}\Omega \, q_b^{1/\sigma}p_i^{-1/\sigma - 1}\, \cdot \\ 
& \sum_{n \in \mathcal{N} }  \sum_{{A}\,|\,n}\left( 1( i \in A ) \hat{f}(a,A)\left[\sum_{i'\in A}\left( \frac{p_{b(i')}}{q_{b(i')}}\right)^{-1/\sigma}\right]^{\sigma (\kappa - 1)-1}\right)\label{eq:full-total-demand-multiple-cohorts-summand}
\end{align}
Since firms within the same cohort possess the same quality, fixing $n \in \mathcal{N}$ and $A$ conditional on $n$, the summand within the bracket in \cref{eq:full-total-demand-multiple-cohorts-summand} can be rewritten as 
\begin{align}
\sum_{i'\in A}\left( \frac{p_{b(i')}}{q_{b(i')}}\right)^{-1/\sigma} &= \sum_{b' \neq b } n_{b'} \left( \dfrac{p_{b'}}{q_{b'}}  \right)^{-1/\sigma} +   
\dfrac{p_i^{-1/\sigma} + (n_b-1) p^{-1/\sigma}_{b} }{ q_b^{-1/\sigma }} \\
&= \sum_{b' =1 }^{\bar{b}} n_{b'} \left( \dfrac{p_{b'}}{q_{b'}}  \right)^{-1/\sigma} +   
\dfrac{p_i^{-1/\sigma}   - p^{-1/\sigma}_{b} }{{ q_b^{-1/\sigma }}} \label{eq:full-total-demand-multiple-cohorts-summand-alternative}
\end{align}


Note that, conditional on $n_b > 0$, the probability of a $b$-cohort firm being included in the $n_b$ awared firms out of total $N$ firms is $n_b /N$ (Polya urn). Hence, combined with \cref{eq:full-total-demand-multiple-cohorts-summand-alternative},  \cref{eq:full-total-demand-multiple-cohorts} can be written in terms of cross-cohort awareness counts as
\begin{align}
y_{ib}(p_i, p_{-i}, f) 
&=  \overline{\Gamma}^{1 - \kappa} \Omega q_b^{1/\sigma} p_i^{-1/\sigma-1} \dfrac{1}{N} \cdot 
\label{eq:full-total-demand-multiple-cohorts-alternative-first} \\ 
&\sum_{ n \in \mathcal{N} } n_b f_n \Bigg[ \sum_{b' =1 }^{\bar{b}} n_{b'} \left( \dfrac{p_{b'}}{q_{b'}}  \right)^{-1/\sigma} +   
\dfrac{p_i^{-1/\sigma}   - p^{-1/\sigma}_{b}}{{ q_b^{-1/\sigma }}}  \Bigg]^{\sigma(\kappa-1) -1}
\label{eq:full-total-demand-multiple-cohorts-alternative-second}
\end{align}

\subsection{Demand with a Single Cohort with Two Qualities}

Let $q_k$ and $p_k$ denote the quality of all firms in quality type $k \in \{H, L\}$ where $q_H \geq q_L$. $N_k$ represents the total number of firms with quality $k$. Since we consider a single cohort case, $\mathcal{N} = \{0\} \cup \mathbb{N}$. Consider the demand function faced by firm $i$ in quality type $H$ (quality type $L$ case is symmetric) as having price $p_i$. Note that 
\begin{align}
y_{i}(p_i, p_{-i}, f)  = \bar{\Gamma}^{1-\kappa}\Omega \, q_H^{1/\sigma}p_i^{-1/\sigma - 1}\,\sum_{{A}\,|\, i}\left(\hat{f}(a,A)\left[\sum_{i'\in A}\left( \frac{p_{k(i')}}{q_{k(i')}}\right)^{-1/\sigma}\right]^{\sigma (\kappa - 1)-1}\right)\label{eq:full-total-demand-two-quality}
\end{align}
holds by \cref{eq:full-total-demand} where $k(i')$ denotes the quality type firm $i'$ belongs to. 

The summation in \eqref{eq:full-total-demand-two-quality} is an expectation with respect to the random awareness set conditional on firm $i$ being awared. For $n \in \mathcal{N}$, note that firm $i$ is awared if and only if $A$ conditional on $n$ contains firm $i$. Letting $n_k$ denote the number of awared firms with $k \in \{H, L\}$ quality type, \eqref{eq:full-total-demand-two-quality} can be rewritten as
\begin{align}
	y_{i}(p_i, p_{-i}, f) &= \bar{\Gamma}^{1-\kappa}\Omega \, q_H^{1/\sigma}p_i^{-1/\sigma - 1}\, \cdot \\ 
	& \sum_{n \in \mathcal{N} }  \sum_{{A}\,|\,n}\left( 1( i \in A ) \hat{f}(a,A)\left[\sum_{i'\in A}\left( \frac{p_{k(i')}}{q_{k(i')}}\right)^{-1/\sigma}\right]^{\sigma (\kappa - 1)-1}\right)  \\
	&= \bar{\Gamma}^{1-\kappa}\Omega \, q_H^{1/\sigma}p_i^{-1/\sigma - 1}\, \cdot \\ 
	&\sum_{n \in \mathcal{N} } \sum_{n'_H =1}^n \sum_{{A}\,|\,n; n_H = n'_H}\left( 1( i \in A ) \hat{f}(a,A)\left[\sum_{i'\in A}\left( \frac{p_{k(i')}}{q_{k(i')}}\right)^{-1/\sigma}\right]^{\sigma (\kappa - 1)-1}\right)  
	\label{eq:full-total-demand-two-quality-summand}
\end{align}
Since firms within the same quality group possess the same quality, fixing $n \in \mathcal{N}$ and $n_H \leq n$, by considering $A$ conditional on $n$, the summand within the bracket in \cref{eq:full-total-demand-two-quality-summand} can be rewritten as 
\begin{align}
\sum_{i'\in A}\left( \frac{p_{k(i')}}{q_{k(i')}}\right)^{-1/\sigma} &= \sum_{k' \in \{H, L\} } n_{k'} \left( \dfrac{p_{k'}}{q_{k'}}  \right)^{-1/\sigma} +   
\dfrac{p_i^{-1/\sigma} - p^{-1/\sigma}_{H} }{ q_H^{-1/\sigma }} \\
&= n_H \left( \dfrac{p_{H}}{q_{H}}   \right)^{-1/\sigma} +  
(n - n_H) \left( \dfrac{p_{L}}{q_{L}}   \right)^{-1/\sigma} +
\dfrac{p_i^{-1/\sigma} - p^{-1/\sigma}_{H} }{ q_H^{-1/\sigma }}  \label{eq:full-total-demand-two-quality-summand-alternative}
\end{align}
where the second equation follows from the fact that $n = n_H + n_L$.

For a given awareness set $A$, firm $i$ is awared if and only if $n_H$ firms of type $H$ awared and $i$ is included in the awared $n_H$ firms of type $H$, with the probability represented by
\begin{equation}\label{eq:two-quality-firm-awareness-probability-symbol}
P( \text{\{Firm $i$ is awared\} $\cap$ \{$n_H$ firms of type $H$ are awared\}})
\end{equation}
which is identical with
 \begin{equation}
P( \text{\{Firm $i$ is awared\} | \{$n_H$ firms of type $H$ are awared\}}) \cdot P( \text{\{$n_H$ firms of type $H$ are awared\}}) 
 \end{equation}
Conditional on $n_H$, the number of firms of type $H$ awared out of $n$ firms, the probability of firm $i$ being included in the awared $n_H$ firms out of total $N_H$ firms in type $H$ is $n_H / N_H$ (Polya urn). Note that the probability of having $n_H$ firms from type $H$ out of $n$ draws is $\binom{N_H}{n_H} \binom{N_L}{n - n_H} / \binom{N_H + N_L}{n}$ (hypergeometric distribution). Hence, \eqref{eq:two-quality-firm-awareness-probability-symbol} is identical with
\begin{equation}\label{eq:two-quality-firm-awareness-probability}
\dfrac{n_H}{N_H}
\dfrac{\binom{N_H}{n_H} \binom{N_L}{n - n_H}}{\binom{N_H + N_L}{n}} 
\end{equation}

Thus, combined with \eqref{eq:full-total-demand-two-quality-summand-alternative} and \eqref{eq:two-quality-firm-awareness-probability},  \eqref{eq:full-total-demand-two-quality-summand} can be rewritten as
\begin{equation}\label{eq:full-total-demand-two-quality-alternative}
\begin{aligned}
& y_{i}(p_i, p_{-i}, f) 
=  \bar{\Gamma}^{1-\kappa}\Omega \, q_H^{1/\sigma}p_i^{-1/\sigma - 1}\, \dfrac{1}{N_H} \cdot \\ 
&\sum_{n \in \mathcal{N} } f_n   \sum_{n_H =1}^n  
n_H \dfrac{\binom{N_H}{n_H} \binom{N_L}{n - n_H}}{\binom{N_H + N_L}{n}}
\left( 
n_H \left( \dfrac{p_{H}}{q_{H}}   \right)^{-1/\sigma} +  
(n - n_H) \left( \dfrac{p_{L}}{q_{L}}   \right)^{-1/\sigma} +
\dfrac{p_i^{-1/\sigma} - p^{-1/\sigma}_{H} }{ q_H^{-1/\sigma }} 
\right)^{\sigma (\kappa - 1)-1}
\end{aligned}
\end{equation}

\subsubsection{Deriving Demand with Symmetric Quality from Two Quality Demand}
\eqref{eq:full-total-demand-two-quality-alternative} nests the symmetric quality formula with a single cohort, by taking $N_L = 0$ and $\bar b = 1$. To see this, first note that
\begin{equation}
\dfrac{\binom{N_H}{n_H} \binom{0}{n - n_H}}{\binom{N_H}{n}} = 
\begin{cases}
1 & \text{if $n = n_H$} \\
0 & \text{otherwise} 
\end{cases}
\end{equation}
as the hypergeometric distribution has support on $\{\max(0, n+N_H - (N_H + N_L) ), ..., \min (n, N_H )  \}$, which is $\{n\}$ when $N_L = 0$. Hence, in this case, \eqref{eq:full-total-demand-two-quality-alternative} can be rewritten as
\begin{align}
 y_{i}(p_i, p_{-i}, f) 
&=  \bar{\Gamma}^{1-\kappa}\Omega \, q_H^{1/\sigma}p_i^{-1/\sigma - 1}\, \dfrac{1}{N_H} \cdot \\ 
&\sum_{n \in \mathcal{N}, n_H = n } f_{n}  
n_H 
\left( 
n_H \left( \dfrac{p_{H}}{q_{H}}   \right)^{-1/\sigma} +  
(n - n_H) \left( \dfrac{p_{L}}{q_{L}}   \right)^{-1/\sigma} +
\dfrac{p_i^{-1/\sigma} - p^{-1/\sigma}_{H} }{ q_H^{-1/\sigma }} 
\right)^{\sigma (\kappa - 1)-1}  \\
&=  \bar{\Gamma}^{1-\kappa}\Omega \, q_H^{1/\sigma}p_i^{-1/\sigma - 1}\, \dfrac{1}{N_H} \cdot \sum_{n \in \mathcal{N}} f_{n}  
n
\left( 
n \left( \dfrac{p_{H}}{q_{H}}   \right)^{-1/\sigma} +  
\dfrac{p_i^{-1/\sigma} - p^{-1/\sigma}_{H} }{ q_H^{-1/\sigma }} 
\right)^{\sigma (\kappa - 1)-1}
\end{align}
which is equivalent with \eqref{eq:full-total-demand-multiple-cohorts-alternative-first} -- \eqref{eq:full-total-demand-multiple-cohorts-alternative-second} by taking $N = N_H$, $p_b = p_H$, and $q_b = q_H$.


\subsubsection{Extension: Demand with a Single Cohort with Multiple Qualities}
The formula \eqref{eq:full-total-demand-two-quality-alternative} can be extended to multiple $K$ quality types with arbitrary $K > 1$. Consider the demand function faced by firm $i$ in quality type $k$ as having price $p_i$. Using a similar argument as above, it can be shown that the demand function can be represented by
\begin{align}
y_{ik}(p_i, p_{-i}, f) 
&= \bar{\Gamma}^{1-\kappa}\Omega \, q_k^{1/\sigma}p_i^{-1/\sigma - 1}\, \cdot \\ 
&\sum_{n \in \mathcal{N} } \sum_{n'_k =1}^n \sum_{{A}\,|\,n; n_k = n'_k}\left( 1( i \in A ) \hat{f}(a,A)\left[\sum_{i'\in A}\left( \frac{p_{k(i')}}{q_{k(i')}}\right)^{-1/\sigma}\right]^{\sigma (\kappa - 1)-1}\right)  
\label{eq:full-total-demand-multiple-quality-summand}
\end{align}

We introduce $v_{n_k} (n)$, a $K$-length vector of zeros and (or) natural numbers whose sum is $n$ and $k$th element is fixed by $n_k \leq n$, such that its $k'$th element represents the number of awared firms with type $k'$. Let $\mathcal{V}_{n_k} (n)$ denote the collection of all $v_{n_k} (n)$. Then, given $v \in \mathcal{V}_{n_k} (n)$, the summand in \eqref{eq:full-total-demand-multiple-quality-summand} can be represented by
\begin{equation}
\sum_{i'\in A}\left( \frac{p_{k(i')}}{q_{k(i')}}\right)^{-1/\sigma} = 
\sum_{k' =1 }^{K} v_{k'} \left( \dfrac{p_{k'}}{q_{k'}}  \right)^{-1/\sigma} +   
\dfrac{p_i^{-1/\sigma}   - p^{-1/\sigma}_{k} }{{ q_k^{-1/\sigma }}}
\label{eq:full-total-demand-multiple-quality-summand-alternative}
\end{equation}
where $v_{k'}$ is the $k'$th element of $v$. It is worth mentioning that the second equation in \eqref{eq:full-total-demand-two-quality-summand-alternative} does not follow since fixing $n_k$ is not sufficient to figure out $n_{k'}$ for $k \neq k'$ when $K > 2$.

For a given awareness set $A$, firm $i$ of type $k$ is awared if and only if $v$ firms are awared for some $v \in \mathcal{V}_{n_k} (n)$ and $i$ is included in the awared $v$ firms, with the probability represented by
\begin{equation}\label{eq:multiple-quality-firm-awareness-probability-symbol}
P( \text{\{Firm $i$ is awared\} $\cap$ \{$v$ firms are awared\}})
\end{equation}
which is identical with
\begin{equation}
P( \text{\{Firm $i$ is awared\} | \{$v$ firms are awared\}}) \cdot P( \text{\{$v$ firms are awared\}}) 
\end{equation}

Conditional on $v \in \mathcal{V}_{n_k} (n)$, whose $k$th element is $n_k$ (the number of firms of type $k$ awared out of $n$ firms), the probability of firm $i$ being included in the awared $n_k$ firms out of total $N_k$ firms in type $k$ is $n_k / N_k$ (Polya urn). Note that the probability of having $v \in \mathcal{V}_{n_k}(n)$ firms awared out of $n$ draws is $\prod_{k'=1}^K \binom{ N_{k'} }{ v_{k'} } / \binom{N}{n}$ (multivariate hypergeometric distribution) where $N = \sum_{k'=1}^K N_{k'}$. Hence, \eqref{eq:multiple-quality-firm-awareness-probability-symbol} is identical with
\begin{equation}\label{eq:multiple-quality-firm-awareness-probability}
\dfrac{n_k}{N_k}
\dfrac{\prod_{k'=1}^K \binom{ N_{k'} }{ v_{k'} } }{\binom{N}{n}}
\end{equation}

Thus, combined with \eqref{eq:full-total-demand-multiple-quality-summand-alternative} and \eqref{eq:multiple-quality-firm-awareness-probability}, we have
\begin{align}
& y_{ik}(p_i, p_{-i}, f) 
=  \bar{\Gamma}^{1-\kappa}\Omega \, q_k^{1/\sigma}p_i^{-1/\sigma - 1}\, \dfrac{1}{N_k} \cdot \\ 
&\sum_{n \in \mathcal{N} } f_n   \sum_{n_k =1}^n  
n_k \sum_{v \in \mathcal{V}_{n_k} (n)} 
\dfrac{\prod_{k'=1}^K \binom{ N_{k'} }{ v_{k'} } }{\binom{N}{n}}
\left( 
\sum_{k' =1 }^{K} v_{k'} \left( \dfrac{p_{k'}}{q_{k'}}  \right)^{-1/\sigma} +   
\dfrac{p_i^{-1/\sigma}   - p^{-1/\sigma}_{k} }{{ q_k^{-1/\sigma }}}
\right)^{\sigma (\kappa - 1)-1}
\end{align}

\subsection{Demand with Multiple Cohorts with Two Qualities}
Consider firm $i$ of type $H$ in cohort $b$ as having price $p_i$; the demand function firms in the other type, $L$, can be deduced symmetrically. Without loss of generality, we assume that $N_H$ and $N_L$ are fixed for all cohorts for brevity.  

Let $\mathcal{V} (n)$ denote the collection of $\bar b$-length vectors whose $b'$th element represents the number of awared firms of type $H$ from cohort $b'$ given $n$, i.e., vectors whose $b'$th element $n_{Hb'}$ has the value of $\{0,..., n_{b'} \}$. It is worth mentioning that given $n$, the size of $\mathcal{V} (n)$ is $\prod_{b'=1}^{\bar b} (n_{b'} + 1)$. Then, the demand function can be represented by
\begin{align}
y_{ib}(p_i, p_{-i}, f) &= \bar{\Gamma}^{1-\kappa}\Omega \, q_H^{1/\sigma}p_i^{-1/\sigma - 1}\, \cdot \\
& \sum_{n \in \mathcal{N} } \sum_{n'_k =1}^n \sum_{{A}\,|\,n; n_k = n'_k}\left( 1( i \in A ) \hat{f}(a,A)\left[\sum_{i'\in A}\left( \frac{p_{k(i')}}{q_{k(i')}}\right)^{-1/\sigma}\right]^{\sigma (\kappa - 1)-1}\right)  
\label{eq:full-total-demand-multiple-cohorts-two-quality}
\end{align}
holds by \cref{eq:full-total-demand} where $b(i')$ denotes the cohort firm $i'$ belongs to. 


Let $\mathcal{V} (n)$ denote the collection of $\bar b$-length vectors whose $b'$th element represents the number of awared firms of type $H$ from cohort $b'$ given $n$, i.e., vectors whose $b'$th element $n_{Hb'}$ has the value of $\{0,..., n_{b'} \}$. It is worth mentioning that given $n$, the size of $\mathcal{V} (n)$ is $\prod_{b'=1}^{\bar b} (n_{b'} + 1)$. Then, as in \eqref{eq:full-total-demand-multiple-quality-summand-alternative}, the demand function can be represented as

\begin{equation}\label{eq:full-total-demand-two-quality-multiple-cohort}
\begin{aligned}
& y_{ib}(p_i, p_{-i}, f) 
=  \bar{\Gamma}^{1-\kappa}\Omega \, q_H^{1/\sigma}p_i^{-1/\sigma - 1}\, \dfrac{1}{N_H} \cdot  \\ 
& \quad \sum_{n \in \mathcal{N} } f_n   \sum_{n_H \in \mathcal{V} (n) }  
\Bigg\{
P( \text{\{Firm $i$ is awared\} $\cap$ \{$n_H$ firms are awared\}})
\cdot \\ & \quad
\Bigg[
\sum_{b' = 1}^{\bar b} 
\left(
n_{Hb'} \left( \dfrac{p_{Hb}}{q_{H}}   \right)^{-1/\sigma} +  
(n - n_{Hb'}) \left( \dfrac{p_{Lb}}{q_{L}}   \right)^{-1/\sigma} \right) + 
\dfrac{p_i^{-1/\sigma} - p^{-1/\sigma}_{Hb} }{ q_H^{-1/\sigma }} 
\Bigg]^{\sigma (\kappa - 1)-1} \Bigg\}
\end{aligned}
\end{equation}

Note that $P( \text{\{Firm $i$ is awared\} $\cap$ \{$n_H$ firms are awared\}})$ in \eqref{eq:full-total-demand-two-quality-multiple-cohort} is identical with the product of the following two probabilities: $P( \text{\{Firm $i$ is awared | $n_H$ firms are awared\}})$ and $P( \text{\{$n_H$ firms are awared\}})$. Conditional on $n_{H} \in \mathcal{V}(n)$ and $n$, the number of firms of type $H$ awared out of $n$ firms, the probability of firm $i$ being included in the awared $n_{Hb}$ firms out of total $N_H$ firms in type $k$ is $n_{Hb} / N_{H}$ (Polya urn). As in \eqref{eq:full-total-demand-two-quality-alternative}, for each $b'$ cohort, the probability of having having $n_{Hb'}$ firms from type $H$ out of $n_{b'}$ draws is
$
 {\binom{N_H}{n_{Hb'}} \binom{N_L}{n_{b'} - n_{Hb'}}}/{\binom{N_H + N_L}{n_{b'}}}
$
(hypergeometric distribution). Since the awareness process is independent across all cohorts, $v \in \mathcal{V}(n)$ firms awared out of $n$ draws is $
\prod_{b'=1}^{\bar b} \left[ {\binom{N_H}{n_{Hb'}} \binom{N_L}{n_{b'} - n_{Hb'}}}/{\binom{N_H + N_L}{n_{b'}}} \right]$. Hence, the demand function is
\begin{equation}\label{eq:full-total-demand-two-quality-multiple-cohort-alternative}
\begin{aligned}
& y_{ib}(p_i, p_{-i}, f) 
=  \bar{\Gamma}^{1-\kappa}\Omega \, q_H^{1/\sigma}p_i^{-1/\sigma - 1}\, \dfrac{1}{N_H} \cdot  \\ 
& \quad \sum_{n \in \mathcal{N} } f_n   \sum_{n_H \in \mathcal{V} (n) }  
\Bigg\{
\left[ n_{Hb} \prod_{b'=1}^{\bar b} 
 \dfrac{\binom{N_H}{n_{Hb'}} \binom{N_L}{n_{b'} - n_{Hb'}}}{\binom{N_H + N_L}{n_{b'}}}
\right] \cdot \\ & \quad
\Bigg[
\sum_{b' = 1}^{\bar b} 
\left(
n_{Hb'} \left( \dfrac{p_{Hb}}{q_{H}}   \right)^{-1/\sigma} +  
(n - n_{Hb'}) \left( \dfrac{p_{Lb}}{q_{L}}   \right)^{-1/\sigma} \right) + 
\dfrac{p_i^{-1/\sigma} - p^{-1/\sigma}_{Hb} }{ q_H^{-1/\sigma }} 
\Bigg]^{\sigma (\kappa - 1)-1} \Bigg\}
\end{aligned}
\end{equation}


\section{General Notation}
This section establishes some general notation used in the solutions.
Define the lexicographic ordering matrix as
\begin{align}
	\mathbf{L} &\equiv \begin{bmatrix}0& 0& \ldots& 0\\
											1& 0& \ldots& 0\\
											0& 1& \ldots& 0\\
											\ldots\\
											1& 1& \ldots& 1\\
	\end{bmatrix}_{\mathbf{N} \times N}\label{eq:lexicographic-matrix}
\end{align}
In \cref{eq:lexicographic-matrix}, each row represents a possible awareness state for an individual, with the $N$ firms ordered on the horizontal axis.  For a given row, a $0$ denotes that the firm is not in that awareness state, and $1$ denotes that it is.  \cref{tab:lexicographic-comparison} provides an example of the mapping.  Additionally, define the following vectors and matrices:
\begin{enumerate}
	\item $\mathbf{I}$ is the diagonal matrix of size $N\times N$
	\item $\vec{\mathbf{1}}$ is the vector of 1's of size $N$
	\item $\mathbf{e}_{\iota}$ is a vector of 0's with a $1$ at the $\iota$'th position
%	\item An example of the matrix transpose is $A^T$
\end{enumerate}
{\small
\begin{table}[h]
	\centering
	\begin{tabularx}{\linewidth}{l | X | X}
	\hline\hline
$\iota$ Index & Set ${A}_{j}(t)$ & Row of $L$\\
\hline
	$1$&$\set{\emptyset}$&$\begin{bmatrix}0& 0& 0& 0& \ldots& 0\end{bmatrix}$\\
	$2$&$\set{1}$&$\begin{bmatrix}1& 0& 0&0& \ldots& 0\end{bmatrix}$\\
	$3$&$\set{2}$&$\begin{bmatrix}0& 1& 0&0& \ldots& 0\end{bmatrix}$\\
	\ldots& &\\
	$N + 2$&$\set{1,2}$&$\begin{bmatrix}1& 1& 0&0& \ldots& 0\end{bmatrix}$\\
	$N+3$&$\set{1, 3}$&$\begin{bmatrix}1& 0& 1& 0&\ldots& 0\end{bmatrix}$\\
	\ldots& &\\
	$\mathbf{N}$&$\set{1, 2 \ldots N}$&$\begin{bmatrix}1& 1& 1& 1&\ldots& 1\end{bmatrix}$\\
\hline
\end{tabularx}
	\caption{Lexicographic Ordering of States}
	\label{tab:lexicographic-comparison}
\end{table}
}

\end{document}
